{"version":3,"file":"create-from-user.mjs","sources":["../../../../../../../../server/api/orders/create-from-user.ts"],"sourcesContent":null,"names":["createFromUser","defineEventHandler","async","event","method","getMethod","supabase","serverSupabaseClient","respondError","requireAuth","authUser","serverSupabaseUser","body","readBody","customer_id","order_items","length","data","profile","error","profileError","from","select","eq","id","single","role","is_active","customer","customerError","subtotal","orderItems","nowIso","Date","toISOString","offers","offerMap","Map","o","validFromOk","valid_from","validToOk","valid_to","set","product_id","Number","discount_percent","item","quantity","product","productError","stock_quantity","name","basePrice","price","discount","get","unitPrice","Math","round","totalPrice","push","unit_price","total_price","taxAmount","tax_amount","shippingAmount","shipping_amount","totalAmount","newOrder","total_amount","status","shipping_address","billing_address","payment_method","payment_status","tracking_number","notes","order_source","assigned_user_id","orderRes","insert","orderData","orderError","message","orderItemsWithOrderId","map","i","order_id","id_order","itemsError","delete","respondSuccess","console"],"mappings":"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"}