{"version":3,"file":"update-status.mjs","sources":["../../../../../../../../../server/api/orders/[id]/update-status.ts"],"sourcesContent":null,"names":["updateStatus","defineEventHandler","async","event","method","getMethod","supabase","serverSupabaseClient","id","getRouterParam","data","success","error","body","readBody","status","validStatuses","includes","currentOrderRes","from","select","eq","single","fetchError","currentOrder","code","console","details","message","currentStatus","newStatus","allowedTransitions","pending","confirmed","shipped","delivered","cancelled","join","tracking_number","payment_status","updateData","updated_at","Date","toISOString","trim","notes","updateRes","update","orderItemsRes","itemsError","orderItems","item","stockError","rpc","p_id_product","product_id","p_delta","Number","quantity","productRes","productError","product","stock_quantity","warn","name","id_order"],"mappings":"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"}