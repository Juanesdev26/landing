{"version":3,"file":"stats.mjs","sources":["../../../../../../../../server/api/orders/stats.ts"],"sourcesContent":null,"names":["stats","defineEventHandler","async","event","method","getMethod","supabase","serverSupabaseClient","respondError","requireAdmin","query","getQuery","startDate","start_date","Date","endDate","end_date","applyDateFilters","builder","gte","toISOString","lte","count","totalOrders","error","totalError","from","select","head","console","success","details","message","data","statusRows","statusError","ordersByStatus","reduce","acc","row","status","paymentRows","paymentError","ordersByPaymentStatus","payment_status","salesRows","salesError","totalSales","sum","total_amount","oneYearAgoIso","now","monthRows","monthError","ordersByMonth","monthlyData","order","date","created_at","monthKey","getFullYear","String","getMonth","padStart","orders","sales","Object","entries","map","month","sort","a","b","localeCompare","productRows","productsError","topProducts","productSales","item","productName","_a","product","name","productSku","_b","sku","key","quantity","values","slice","customerRows","customersError","topCustomers","customerStats","customerId","customer_id","customerName","customer","first_name","last_name","customerEmail","email","total_spent","pendingOrders","pending","confirmedOrders","confirmed","shippedOrders","shipped","deliveredOrders","delivered","cancelledOrders","cancelled","pendingPayments","paidPayments","paid","failedPayments","failed","refundedPayments","refunded","totalOrdersCount","totalSalesAmount","averageOrderValue","respondSuccess","summary","total_orders","total_sales","average_order_value","Math","round","pending_orders","confirmed_orders","shipped_orders","delivered_orders","cancelled_orders","monthly_trends","top_products","top_customers","date_range"],"mappings":"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"}