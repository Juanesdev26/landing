import{d as r,g as e,r as o,s as t,e as i,h as s,b as a}from"../../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const d=r(async r=>{var d;if("POST"!==e(r))return o("Método no permitido");try{const e=await t(r),n=await i(r);if(!n)return o("No autenticado");const p=s(r,"id");if(!p)return o("ID de pedido requerido");const{data:u,error:c}=await e.from("orders").select("id_order, status, customer_id, customers!inner(user_id)").eq("id_order",p).maybeSingle();if(c||!u)return o("Pedido no encontrado");if((null==(d=u.customers)?void 0:d.user_id)!==n.id)return o("No autorizado");if("pending"!==u.status)return o("Solo se puede cancelar si está pendiente");const m=(await e.from("orders").update({status:"cancelled",updated_at:(new Date).toISOString()}).eq("id_order",p)).error;return m?o("No se pudo cancelar el pedido",m.message):a(null,"Pedido cancelado")}catch(r){return console.error("POST /api/orders/[id]/cancel error:",r),o("Error interno del servidor")}});export{d as default};
//# sourceMappingURL=cancel.mjs.map
