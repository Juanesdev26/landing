{"version":3,"file":"update-payment.mjs","sources":["../../../../../../../../../server/api/orders/[id]/update-payment.ts"],"sourcesContent":null,"names":["updatePayment","defineEventHandler","async","event","method","getMethod","supabase","serverSupabaseClient","id","getRouterParam","data","success","error","body","readBody","payment_status","validPaymentStatuses","includes","currentOrderRes","from","select","eq","single","fetchError","currentOrder","code","console","details","message","currentPaymentStatus","newPaymentStatus","allowedPaymentTransitions","pending","paid","failed","refunded","join","updateData","updated_at","Date","toISOString","notes","trim","payment_method","payment_reference","clientAny","updateRes","update","status","orderItemsRes","itemsError","orderItems","item","stockError","rpc","p_id_product","product_id","p_delta","Number","quantity","id_order"],"mappings":"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"}