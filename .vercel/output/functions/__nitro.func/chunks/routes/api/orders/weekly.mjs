import{d as t,g as e,s as r,r as o,a as s,b as a}from"../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const n=t(async t=>{const n=e(t),i=await r(t);if("GET"!==n)return o("MÃ©todo no permitido");try{await s(t);const e=7,r=new Date;r.setDate(r.getDate()-(e-1)),r.setHours(0,0,0,0);const n=r.toISOString(),{data:c,error:d}=await i.from("orders").select("created_at, total_amount").gte("created_at",n).order("created_at",{ascending:!0});if(d)return o("Error obteniendo ventas semanales",d.message);const p={},m=new Date(r);for(let t=0;t<e;t++){p[m.toISOString().slice(0,10)]=0,m.setDate(m.getDate()+1)}const l=c||[];for(const t of l){const e=new Date(t.created_at).toISOString().slice(0,10);p[e]=(p[e]||0)+(t.total_amount||0)}const u=Object.entries(p).map(([t,e])=>({date:t,sales:e}));return a({series:u})}catch(t){return console.error("GET /api/orders/weekly error:",t),o("Error interno del servidor")}});export{n as default};
//# sourceMappingURL=weekly.mjs.map
