import{d as t,g as e,s as o,r,c as s,e as i,b as a}from"../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const n=t(async t=>{const n=e(t),l=await o(t);if("GET"!==n)return r("Método no permitido");try{await s(t);const e=await i(t);if(!e)return r("No autenticado");const{data:o}=await l.from("customers").select("*").eq("user_id",e.id).single();if(o)return a(o);const{data:n}=await l.from("profiles").select("first_name, last_name, email, phone, address, city, state, postal_code, country, role").eq("id",e.id).single(),d={user_id:e.id,first_name:(null==n?void 0:n.first_name)||"Cliente",last_name:(null==n?void 0:n.last_name)||"N/A",email:(null==n?void 0:n.email)||e.email,phone:(null==n?void 0:n.phone)||null,address:(null==n?void 0:n.address)||null,city:(null==n?void 0:n.city)||null,state:(null==n?void 0:n.state)||null,postal_code:(null==n?void 0:n.postal_code)||null,country:(null==n?void 0:n.country)||"México",is_active:!0},{data:m,error:u}=await l.from("customers").insert(d).select().single();return u?r("Error creando cliente",u.message):a(m)}catch(t){return console.error("Error en GET /api/customers/my:",t),r("Error interno del servidor")}});export{n as default};
//# sourceMappingURL=my.mjs.map
