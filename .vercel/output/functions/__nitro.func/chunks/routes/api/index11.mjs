import{d as r,g as e,s as o,a as t,m as s,r as i,b as a,k as n}from"../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const d=r(async r=>{const d=e(r),u=await o(r);if("GET"===d)try{await t(r);const e=s(r),o=e.user_id?String(e.user_id):null;let n=u.from("user_offers").select("\n          *,\n          user:profiles(id, email, first_name, last_name, role),\n          product:products(id_product, name, sku, price, image_url)\n        ").order("created_at",{ascending:!1});o&&(n=n.eq("user_id",o));const{data:d,error:c}=await n;return c?i("Error obteniendo ofertas",c.message):a(d)}catch(r){return console.error("Error en GET /api/user-offers:",r),i("Error interno del servidor")}if("POST"===d)try{await t(r);const e=await n(r);if(!e.user_id||!e.product_id||void 0===e.discount_percent)return i("user_id, product_id y discount_percent son requeridos");const o={user_id:e.user_id,product_id:e.product_id,discount_percent:Number(e.discount_percent),is_active:void 0===e.is_active||!!e.is_active,valid_from:e.valid_from||null,valid_to:e.valid_to||null,notes:e.notes||null},{data:s,error:d}=await u.from("user_offers").insert(o).select().single();return d?i("Error creando oferta",d.message):a(s,"Oferta creada exitosamente")}catch(r){return console.error("Error en POST /api/user-offers:",r),i("Error interno del servidor")}return i("MÃ©todo no permitido")});export{d as default};
//# sourceMappingURL=index11.mjs.map
