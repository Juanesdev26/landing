import{d as e,g as o,s as t,h as r,n as s,b as a,a as i,k as n,r as d}from"../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const p=e(async e=>{var p,u;const c=o(e),m=await t(e),l=r(e,"id");if(!l)throw s({statusCode:400,statusMessage:"ID de proveedor requerido"});try{if("GET"===c){const{data:e,error:o}=await m.from("providers").select("\n          *,\n          products:products(count)\n        ").eq("id_provider",l).single();if(o){if("PGRST116"===o.code)throw s({statusCode:404,statusMessage:"Proveedor no encontrado"});throw o}const t={...e,product_count:(null==(u=null==(p=null==e?void 0:e.products)?void 0:p[0])?void 0:u.count)||0};return a(t)}if("PUT"===c){await i(e);const o=await n(e);if(!o.name||0===o.name.trim().length)throw s({statusCode:400,statusMessage:"El nombre del proveedor es obligatorio"});const{data:t,error:r}=await m.from("providers").select("id_provider").eq("name",o.name.trim()).neq("id_provider",l).single();if(r&&"PGRST116"!==r.code)throw r;if(t)throw s({statusCode:400,statusMessage:"Ya existe otro proveedor con ese nombre"});const{data:d,error:p}=await m.from("providers").update({name:o.name.trim(),email:o.email||null,phone:o.phone||null,address:o.address||null,contact_person:o.contact_person||null,is_active:void 0===o.is_active||o.is_active,updated_at:(new Date).toISOString()}).eq("id_provider",l).select().single();if(p)throw p;return a(d,"Proveedor actualizado exitosamente")}if("DELETE"===c){await i(e);const{error:o}=await m.from("providers").delete().eq("id_provider",l);if(o){if("PGRST116"===o.code)throw s({statusCode:404,statusMessage:"Proveedor no encontrado"});throw o}return a(null,"Proveedor eliminado exitosamente")}throw s({statusCode:405,statusMessage:"Método no permitido"})}catch(e){if(console.error("Error en API de proveedor específico:",e),e.statusCode)throw e;return d(e.statusMessage||e.message||"Error interno del servidor")}});export{p as default};
//# sourceMappingURL=_id_.mjs.map
