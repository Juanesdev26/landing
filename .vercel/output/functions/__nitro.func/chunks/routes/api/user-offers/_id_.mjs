import{d as r,g as e,s as o,h as t,r as i,a,b as s,k as n}from"../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const d=r(async r=>{const d=e(r),f=await o(r),u=t(r,"id");if(!u)return i("ID de oferta requerido");if("GET"===d)try{await a(r);const{data:e,error:o}=await f.from("user_offers").select("\n          *,\n          user:profiles(id, email, first_name, last_name, role),\n          product:products(id_product, name, sku, price, image_url)\n        ").eq("id_offer",u).single();return o?i("Oferta no encontrada"):s(e)}catch(r){return console.error("Error en GET /api/user-offers/[id]:",r),i("Error interno del servidor")}if("PUT"===d)try{await a(r);const e=await n(r),o={};void 0!==e.user_id&&(o.user_id=e.user_id),void 0!==e.product_id&&(o.product_id=e.product_id),void 0!==e.discount_percent&&(o.discount_percent=Number(e.discount_percent)),void 0!==e.is_active&&(o.is_active=!!e.is_active),void 0!==e.valid_from&&(o.valid_from=e.valid_from),void 0!==e.valid_to&&(o.valid_to=e.valid_to),void 0!==e.notes&&(o.notes=e.notes);const{data:t,error:d}=await f.from("user_offers").update(o).eq("id_offer",u).select().single();return d?i("Error actualizando oferta",d.message):s(t,"Oferta actualizada exitosamente")}catch(r){return console.error("Error en PUT /api/user-offers/[id]:",r),i("Error interno del servidor")}if("DELETE"===d)try{await a(r);const{error:e}=await f.from("user_offers").delete().eq("id_offer",u);return e?i("Error eliminando oferta",e.message):s(null,"Oferta eliminada exitosamente")}catch(r){return console.error("Error en DELETE /api/user-offers/[id]:",r),i("Error interno del servidor")}return i("MÃ©todo no permitido")});export{d as default};
//# sourceMappingURL=_id_.mjs.map
