import{d as r,g as o,s as e,r as t,c as a,b as s}from"../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const c=r(async r=>{const c=o(r),n=await e(r);if("GET"!==c)return t("MÃ©todo no permitido");try{await a(r);const{count:o,error:e}=await n.from("profiles").select("id",{count:"exact",head:!0}),{count:t,error:c}=await n.from("products").select("id_product",{count:"exact",head:!0}),{count:d,error:i}=await n.from("orders").select("id_order",{count:"exact",head:!0}),{data:u,error:l}=await n.from("orders").select("total_amount");e&&console.error("usersError",e),c&&console.error("productsError",c),i&&console.error("ordersError",i),l&&console.error("revenueError",l);const m=(u||[]).reduce((r,o)=>r+(o.total_amount||0),0),p=new Date(Date.now()-6048e5).toISOString(),{data:w,error:f}=await n.from("orders").select("total_amount, created_at").gte("created_at",p),_=(w||[]).reduce((r,o)=>r+(o.total_amount||0),0);f&&console.error("weeklySalesError",f);const{count:E,error:h}=await n.from("products").select("id_product",{count:"exact",head:!0}).gte("created_at",p);h&&console.error("newProductsError",h);const{count:y,error:x}=await n.from("orders").select("id_order",{count:"exact",head:!0}).gte("created_at",p);x&&console.error("weeklyOrdersError",x);const{count:b,error:g}=await n.from("customers").select("id_customer",{count:"exact",head:!0});return g&&console.error("customersError",g),s({totalUsers:o||0,totalProducts:t||0,totalOrders:d||0,totalRevenue:m,weeklySales:_||0,newProducts:E||0,weeklyOrders:y||0,totalCustomers:b||0})}catch(r){return console.error("Error en GET /api/dashboard:",r),t("Error interno del servidor")}});export{c as default};
//# sourceMappingURL=index3.mjs.map
