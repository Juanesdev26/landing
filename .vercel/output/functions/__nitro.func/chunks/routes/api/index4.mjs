import{d as o,g as r,s as t,r as e,c as a,l as n,b as i}from"../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const s=o(async o=>{const s=r(o),d=await t(o);if("GET"!==s)return e("MÃ©todo no permitido");try{await a(o),n(o,"Cache-Control","public, max-age=30");const{data:r,error:t}=await d.from("products").select("\n        *,\n        category:categories(name)\n      ").eq("is_active",!0).order("name");if(t)return console.error("Error obteniendo inventario:",t),e("Error obteniendo inventario");const s=(r||[]).map(o=>o.id_product);let c={};if(s.length>0){const{data:o,error:r}=await d.from("inventory_movements").select("product_id, movement_date:created_at").in("product_id",s).order("created_at",{ascending:!1});if(!r&&o)for(const r of o)c[r.product_id]||(c[r.product_id]=r.movement_date)}const m=(r||[]).map(o=>({...o,category:o.category,last_movement_date:c[o.id_product]||null,movements:void 0}));return i(m)}catch(o){return console.error("Error inesperado:",o),e("Error interno del servidor")}});export{s as default};
//# sourceMappingURL=index4.mjs.map
