import{d as e,g as o,s as r,l as t,b as s,a,k as i,n,r as d}from"../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const m=e(async e=>{const m=o(e),p=await r(e);try{if("GET"===m){t(e,"Cache-Control","public, max-age=60");const{data:o,error:r}=await p.from("providers").select("*").order("name");if(r)throw r;const a=(o||[]).map(e=>({...e,product_count:0}));return s(a)}if("POST"===m){await a(e);const o=await i(e);if(!o.name||0===o.name.trim().length)throw n({statusCode:400,statusMessage:"El nombre del proveedor es obligatorio"});const{data:r,error:t}=await p.from("providers").select("id_provider").eq("name",o.name.trim()).single();if(t&&"PGRST116"!==t.code)throw t;if(r)throw n({statusCode:400,statusMessage:"Ya existe un proveedor con ese nombre"});const{data:d,error:m}=await p.from("providers").insert({name:o.name.trim(),email:o.email||null,phone:o.phone||null,address:o.address||null,contact_person:o.contact_person||null,is_active:void 0===o.is_active||o.is_active}).select().single();if(m)throw m;return s(d,"Proveedor creado exitosamente")}throw n({statusCode:405,statusMessage:"MÃ©todo no permitido"})}catch(e){return console.error("Error en API de proveedores:",e),d(e.statusMessage||e.message||"Error interno del servidor")}});export{m as default};
//# sourceMappingURL=index9.mjs.map
