import{d as t,g as e,s as r,a,f as s,m as i,r as o,b as n,c as d,e as u,k as p}from"../../_/nitro.mjs";import{createClient as c}from"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const m=t(async t=>{const m=e(t),l=await r(t);if("GET"===m)try{await a(t);const e=s(),r=c(e.public.supabaseUrl,e.supabaseServiceKey,{auth:{persistSession:!1}}),d=i(t),u=d.status||void 0,p=Number(d.limit||200),m=(new Date).toISOString();await r.from("reservations").update({status:"cancelled",updated_at:(new Date).toISOString()}).lte("expires_at",m).eq("status","pending");let l=r.from("reservations").select("\n          *,\n          user:profiles(id, email, first_name, last_name),\n          product:products(id_product, name, sku, image_url, price)\n        ").order("created_at",{ascending:!1}).limit(p);u&&(l=l.eq("status",u));const{data:f,error:_}=await l;return _?o("Error obteniendo reservas",_.message):n(f)}catch(t){return o("Error interno del servidor")}if("POST"===m)try{await d(t);const e=await u(t);if(!e)return o("No autenticado");const r=await p(t);if(!r.product_id||!r.quantity)return o("product_id y quantity son requeridos");const a=new Date(Date.now()+18e5).toISOString(),s={user_id:e.id,product_id:r.product_id,quantity:Number(r.quantity),status:"pending",notes:r.notes||null,expires_at:r.expires_at||a},{data:i,error:c}=await l.from("reservations").insert(s).select().single();return c?o("Error creando reserva",c.message):n(i,"Reserva creada")}catch(t){return o("Error interno del servidor")}return o("MÃ©todo no permitido")});export{m as default};
//# sourceMappingURL=index10.mjs.map
