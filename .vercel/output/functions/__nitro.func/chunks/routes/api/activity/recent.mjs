import{d as t,g as e,s as r,r as o,a,b as s}from"../../../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";const i=t(async t=>{const i=e(t),n=await r(t);if("GET"!==i)return o("MÃ©todo no permitido");try{await a(t);const e=10,[r,o,i]=await Promise.all([n.from("orders").select("id_order, created_at, status, total_amount").order("created_at",{ascending:!1}).limit(e),n.from("products").select("id_product, name, created_at").order("created_at",{ascending:!1}).limit(e),n.from("customers").select("id_customer, first_name, last_name, created_at").order("created_at",{ascending:!1}).limit(e)]),d=[],m=r.data||[];for(const t of m)d.push({type:"order",timestamp:t.created_at,title:`Orden #${t.id_order} - ${t.status}`,description:`Total: $${t.total_amount||0}`});const c=o.data||[];for(const t of c)d.push({type:"product",timestamp:t.created_at,title:`Producto creado: ${t.name}`});const p=i.data||[];for(const t of p)d.push({type:"customer",timestamp:t.created_at,title:"Nuevo cliente: "+((t.first_name||"")+" "+(t.last_name||""))});const u=d.sort((t,e)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(0,15);return s(u)}catch(t){return console.error("GET /api/activity/recent error:",t),o("Error interno del servidor")}});export{i as default};
//# sourceMappingURL=recent.mjs.map
