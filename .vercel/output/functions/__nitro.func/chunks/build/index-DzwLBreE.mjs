import{_ as e}from"./server.mjs";import{ref as t,computed as s,unref as r,watch as a,mergeProps as l,useSSRContext as o}from"vue";import{ssrRenderAttrs as i,ssrRenderComponent as n,ssrInterpolate as d,ssrRenderAttr as c,ssrIncludeBooleanAttr as u,ssrLooseContain as m,ssrLooseEqual as p,ssrRenderList as v,ssrRenderClass as g}from"vue/server-renderer";import{m as x}from"./ConfirmModal-CNApe-Wu.mjs";import"../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";import"pinia";import"vue-router";import"tailwindcss/colors";import"@iconify/vue";import"reka-ui";import"@vueuse/core";import"tailwind-variants";import"@iconify/utils/lib/css/icon";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"unhead/plugins";const b={__name:"CustomerModal",__ssrInlineRender:!0,props:{customer:{type:Object,default:null}},emits:["close","save"],setup(s,{emit:o}){const v=s,g=t({first_name:"",last_name:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"",birth_date:"",gender:"",notes:"",is_active:!0}),x=t(!1);return a(()=>v.customer,e=>{g.value=e?{first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",address:e.address||"",city:e.city||"",state:e.state||"",postal_code:e.postal_code||"",country:e.country||"",birth_date:e.birth_date?e.birth_date.split("T")[0]:"",gender:e.gender||"",notes:e.notes||"",is_active:void 0===e.is_active||e.is_active}:{first_name:"",last_name:"",email:"",phone:"",address:"",city:"",state:"",postal_code:"",country:"",birth_date:"",gender:"",notes:"",is_active:!0}},{immediate:!0}),(t,a,o,v)=>{const b=e;a(`<div${i(l({class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},v))}><div class="relative top-10 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white"><div class="mt-3"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900">${d(s.customer?"Editar Cliente":"Nuevo Cliente")}</h3><button class="text-gray-400 hover:text-gray-600">`),a(n(b,{name:"heroicons:x-mark",class:"w-6 h-6"},null,o)),a(`</button></div><form class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Nombre <span class="text-red-500">*</span></label><input${c("value",r(g).first_name)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Nombre"></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Apellido <span class="text-red-500">*</span></label><input${c("value",r(g).last_name)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Apellido"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Email <span class="text-red-500">*</span></label><input${c("value",r(g).email)} type="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="email@ejemplo.com"></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Teléfono </label><input${c("value",r(g).phone)} type="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="+52 55 1234 5678"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Calle y Número </label><input${c("value",r(g).address)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Av. Insurgentes 123"></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Ciudad </label><input${c("value",r(g).city)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ciudad de México"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Estado/Provincia </label><input${c("value",r(g).state)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="CDMX"></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Código Postal </label><input${c("value",r(g).postal_code)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="12345"></div></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> País </label><input${c("value",r(g).country)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="México"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Fecha de Nacimiento </label><input${c("value",r(g).birth_date)} type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Género </label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${u(Array.isArray(r(g).gender)?m(r(g).gender,""):p(r(g).gender,""))?" selected":""}>Seleccionar</option><option value="M"${u(Array.isArray(r(g).gender)?m(r(g).gender,"M"):p(r(g).gender,"M"))?" selected":""}>Masculino</option><option value="F"${u(Array.isArray(r(g).gender)?m(r(g).gender,"F"):p(r(g).gender,"F"))?" selected":""}>Femenino</option><option value="O"${u(Array.isArray(r(g).gender)?m(r(g).gender,"O"):p(r(g).gender,"O"))?" selected":""}>Otro</option></select></div></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Notas </label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Información adicional sobre el cliente...">${d(r(g).notes)}</textarea></div><div class="flex items-center"><input${u(Array.isArray(r(g).is_active)?m(r(g).is_active,null):r(g).is_active)?" checked":""} type="checkbox" id="is_active" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"><label for="is_active" class="ml-2 block text-sm text-gray-900"> Cliente activo </label></div><div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 transition-colors"> Cancelar </button><button type="submit"${u(r(x))?" disabled":""} class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">`),r(x)?a("<span>Guardando...</span>"):a(`<span>${d(s.customer?"Actualizar":"Crear")}</span>`),a("</button></div></form></div></div></div>")}}},y=b.setup;b.setup=(e,t)=>{const s=o();return(s.modules||(s.modules=new Set)).add("components/admin/customers/CustomerModal.vue"),y?y(e,t):void 0};const f={__name:"index",__ssrInlineRender:!0,setup(a){const l=t([]),o=t(!1),y=t(""),f=t(""),h=t(""),w=t(1),$=t(10),_=t(!1),A=t(!1),C=t(null),k=t(null),E=s(()=>{let e=l.value;if(y.value){const t=y.value.toLowerCase();e=e.filter(e=>e.first_name.toLowerCase().includes(t)||e.last_name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||e.phone&&e.phone.toLowerCase().includes(t))}return""!==f.value&&(e=e.filter(e=>e.is_active.toString()===f.value)),h.value&&(e=e.filter(e=>e.city===h.value)),e}),j=s(()=>E.value.length),M=s(()=>Math.ceil(j.value/$.value)),N=s(()=>(w.value-1)*$.value),O=s(()=>Math.min(N.value+$.value,j.value)),P=s(()=>{const e=[];let t=Math.max(1,w.value-Math.floor(2.5)),s=Math.min(M.value,t+5-1);s-t+1<5&&(t=Math.max(1,s-5+1));for(let r=t;r<=s;r++)e.push(r);return e}),D=s(()=>{const e=new Set;return l.value.forEach(t=>{t.city&&e.add(t.city)}),Array.from(e).sort()}),z=s(()=>{const e=l.value.length,t=l.value.filter(e=>e.is_active).length,s=new Date;return s.setDate(s.getDate()-30),{total:e,active:t,newCustomers:l.value.filter(e=>new Date(e.created_at)>s).length,withOrders:l.value.filter(e=>(e.order_count||0)>0).length}}),S=async()=>{o.value=!0;try{const{data:e}=await $fetch("/api/customers");e.success?l.value=e.data:console.error("Error en la respuesta de la API:",e.error)}catch(e){console.error("Error fetching customers:",e)}finally{o.value=!1}},T=()=>{_.value=!1,C.value=null},I=async e=>{try{if(C.value){const{data:t}=await $fetch(`/api/customers/${C.value.id_customer}`,{method:"PUT",body:e});t.success?(console.log("Cliente actualizado exitosamente"),await S(),T()):console.error("Error actualizando cliente:",t.error)}else{const{data:t}=await $fetch("/api/customers",{method:"POST",body:e});t.success?(console.log("Cliente creado exitosamente"),await S(),T()):console.error("Error creando cliente:",t.error)}}catch(e){console.error("Error saving customer:",e)}},L=async()=>{if(k.value)try{const{data:e}=await $fetch(`/api/customers/${k.value.id_customer}`,{method:"DELETE"});e.success?(console.log("Cliente eliminado exitosamente"),await S(),A.value=!1,k.value=null):console.error("Error eliminando cliente:",e.error)}catch(e){console.error("Error deleting customer:",e)}};return(t,s,a,l)=>{const o=e,$=b,k=x;s(`<div${i(l)}><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold text-gray-900">Gestión de Clientes</h1><p class="text-gray-600">Administra todos los clientes de tu tienda</p></div><div class="flex space-x-3"><button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">`),s(n(o,{name:"heroicons:plus-circle",class:"w-5 h-5"},null,a)),s('<span>Nuevo Cliente</span></button><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">'),s(n(o,{name:"heroicons:arrow-down-tray",class:"w-5 h-5"},null,a)),s('<span>Exportar</span></button></div></div><div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">'),s(n(o,{name:"heroicons:users",class:"w-5 h-5 text-blue-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Total Clientes</p><p class="text-2xl font-bold text-gray-900">${d(r(z).total)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">`),s(n(o,{name:"heroicons:check-circle",class:"w-5 h-5 text-green-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Activos</p><p class="text-2xl font-bold text-gray-900">${d(r(z).active)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">`),s(n(o,{name:"heroicons:clock",class:"w-5 h-5 text-yellow-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Nuevos (30 días)</p><p class="text-2xl font-bold text-gray-900">${d(r(z).newCustomers)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">`),s(n(o,{name:"heroicons:shopping-bag",class:"w-5 h-5 text-purple-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Con Pedidos</p><p class="text-2xl font-bold text-gray-900">${d(r(z).withOrders)}</p></div></div></div></div><div class="bg-white p-4 rounded-lg shadow-sm mb-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label><input${c("value",r(y))} type="text" placeholder="Nombre, email, teléfono..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Estado</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${u(Array.isArray(r(f))?m(r(f),""):p(r(f),""))?" selected":""}>Todos los estados</option><option value="true"${u(Array.isArray(r(f))?m(r(f),"true"):p(r(f),"true"))?" selected":""}>Activo</option><option value="false"${u(Array.isArray(r(f))?m(r(f),"false"):p(r(f),"false"))?" selected":""}>Inactivo</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Ciudad</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${u(Array.isArray(r(h))?m(r(h),""):p(r(h),""))?" selected":""}>Todas las ciudades</option>\x3c!--[--\x3e`),v(r(D),e=>{s(`<option${c("value",e)}${u(Array.isArray(r(h))?m(r(h),e):p(r(h),e))?" selected":""}>${d(e)}</option>`)}),s('\x3c!--]--\x3e</select></div><div class="flex items-end"><button class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Limpiar Filtros </button></div></div></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Cliente </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Contacto </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Ubicación </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Estado </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Pedidos </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),v(r(E).slice(r(N),r(O)),e=>{var t;s('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">'),s(n(o,{name:"heroicons:user",class:"w-5 h-5 text-blue-600"},null,a)),s(`</div></div><div class="ml-4"><div class="text-sm font-medium text-gray-900">${d(e.first_name)} ${d(e.last_name)}</div><div class="text-sm text-gray-500">${d(e.email)}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${d(e.phone||"N/A")}</div><div class="text-sm text-gray-500">${d((null==(t=e.user)?void 0:t.role)||"Cliente")}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${d(e.city||"N/A")}</div><div class="text-sm text-gray-500">${d(e.state||"N/A")}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${g(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])}">${d(e.is_active?"Activo":"Inactivo")}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${d(e.order_count||0)} pedidos </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><div class="flex space-x-2"><button class="text-blue-600 hover:text-blue-900" title="Ver cliente">`),s(n(o,{name:"heroicons:eye",class:"w-5 h-5"},null,a)),s('</button><button class="text-green-600 hover:text-green-900" title="Editar cliente">'),s(n(o,{name:"heroicons:pencil",class:"w-5 h-5"},null,a)),s(`</button><button class="${g(["hover:text-gray-900",e.is_active?"text-orange-600":"text-green-600"])}"${c("title",e.is_active?"Desactivar":"Activar")}>`),s(n(o,{name:e.is_active?"heroicons:pause":"heroicons:play",class:"w-5 h-5"},null,a)),s('</button><button class="text-red-600 hover:text-red-900" title="Eliminar cliente">'),s(n(o,{name:"heroicons:trash",class:"w-5 h-5"},null,a)),s("</button></div></td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div>"),r(M)>1?(s(`<div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"><div class="flex-1 flex justify-between sm:hidden"><button${u(1===r(w))?" disabled":""} class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Anterior </button><button${u(r(w)===r(M))?" disabled":""} class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:cursor-not-allowed"> Siguiente </button></div><div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700"> Mostrando <span class="font-medium">${d(r(N)+1)}</span> a <span class="font-medium">${d(r(O))}</span> de <span class="font-medium">${d(r(j))}</span> resultados </p></div><div><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"><button${u(1===r(w))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(n(o,{name:"heroicons:chevron-left",class:"w-5 h-5"},null,a)),s("</button>\x3c!--[--\x3e"),v(r(P),e=>{s(`<button class="${g(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",e===r(w)?"z-10 bg-green-50 border-green-500 text-green-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])}">${d(e)}</button>`)}),s(`\x3c!--]--\x3e<button${u(r(w)===r(M))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(n(o,{name:"heroicons:chevron-right",class:"w-5 h-5"},null,a)),s("</button></nav></div></div></div>")):s("\x3c!----\x3e"),s("</div>"),r(_)?s(n($,{customer:r(C),onClose:T,onSave:I},null,a)):s("\x3c!----\x3e"),r(A)?s(n(k,{title:"Eliminar Cliente",message:"¿Estás seguro de que quieres eliminar este cliente? Esta acción no se puede deshacer.",onConfirm:L,onCancel:e=>A.value=!1},null,a)):s("\x3c!----\x3e"),s("</div>")}}},h=f.setup;f.setup=(e,t)=>{const s=o();return(s.modules||(s.modules=new Set)).add("pages/admin/customers/index.vue"),h?h(e,t):void 0};export{f as default};
//# sourceMappingURL=index-DzwLBreE.mjs.map
