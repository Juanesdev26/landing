import{b as e,_ as t}from"./server.mjs";import{ref as s,computed as a,unref as r,defineComponent as o,watch as d,mergeProps as i,reactive as n,useSSRContext as l}from"vue";import{ssrRenderAttrs as c,ssrRenderComponent as u,ssrInterpolate as p,ssrRenderAttr as m,ssrIncludeBooleanAttr as g,ssrLooseContain as v,ssrLooseEqual as y,ssrRenderList as x,ssrRenderClass as b}from"vue/server-renderer";import{t as f}from"./useCurrency-BC2d31xw.mjs";import{m as h}from"./ConfirmModal-CNApe-Wu.mjs";import"../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";import"pinia";import"vue-router";import"tailwindcss/colors";import"@iconify/vue";import"reka-ui";import"@vueuse/core";import"tailwind-variants";import"@iconify/utils/lib/css/icon";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"unhead/plugins";const _={__name:"OrderModal",__ssrInlineRender:!0,props:{order:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:o}){const n=e,l=s(!1),b=s([]),h=s([]),_=s({customer_id:"",status:"pending",shipping_address:"",billing_address:"",payment_method:"",payment_status:"pending",tracking_number:"",tax_amount:0,shipping_amount:0,total_amount:0,notes:"",order_items:[{product_id:"",quantity:1,unit_price:0,total_price:0}]}),w=a(()=>_.value.order_items.reduce((e,t)=>e+(t.total_price||0),0)),$=a(()=>w.value+(_.value.tax_amount||0)+(_.value.shipping_amount||0)),{formatCOP:A}=f(),k2=e=>A(e);return d(()=>n.order,e=>{var t;_.value=e?{customer_id:e.customer_id||"",status:e.status||"pending",shipping_address:e.shipping_address||"",billing_address:e.billing_address||"",payment_method:e.payment_method||"",payment_status:e.payment_status||"pending",tracking_number:e.tracking_number||"",tax_amount:e.tax_amount||0,shipping_amount:e.shipping_amount||0,total_amount:e.total_amount||0,notes:e.notes||"",order_items:(null==(t=e.order_items)?void 0:t.length)?[...e.order_items]:[{product_id:"",quantity:1,unit_price:0,total_price:0}]}:{customer_id:"",status:"pending",shipping_address:"",billing_address:"",payment_method:"",payment_status:"pending",tracking_number:"",tax_amount:0,shipping_amount:0,total_amount:0,notes:"",order_items:[{product_id:"",quantity:1,unit_price:0,total_price:0}]}},{immediate:!0}),(s,a,o,d)=>{const n=t;a(`<div${c(i({class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},d))}><div class="relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white"><div class="mt-3"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900">${p(e.order?"Editar Pedido":"Nuevo Pedido")}</h3><button class="text-gray-400 hover:text-gray-600">`),a(u(n,{name:"heroicons:x-mark",class:"w-6 h-6"},null,o)),a(`</button></div><form class="space-y-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Cliente * </label><select required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(_).customer_id)?v(r(_).customer_id,""):y(r(_).customer_id,""))?" selected":""}>Seleccionar cliente</option>\x3c!--[--\x3e`),x(r(b),e=>{a(`<option${m("value",e.id_customer)}${g(Array.isArray(r(_).customer_id)?v(r(_).customer_id,e.id_customer):y(r(_).customer_id,e.id_customer))?" selected":""}>${p(e.first_name)} ${p(e.last_name)} - ${p(e.email)}</option>`)}),a(`\x3c!--]--\x3e</select></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Estado del Pedido </label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value="pending"${g(Array.isArray(r(_).status)?v(r(_).status,"pending"):y(r(_).status,"pending"))?" selected":""}>Pendiente</option><option value="confirmed"${g(Array.isArray(r(_).status)?v(r(_).status,"confirmed"):y(r(_).status,"confirmed"))?" selected":""}>Confirmado</option><option value="shipped"${g(Array.isArray(r(_).status)?v(r(_).status,"shipped"):y(r(_).status,"shipped"))?" selected":""}>Enviado</option><option value="delivered"${g(Array.isArray(r(_).status)?v(r(_).status,"delivered"):y(r(_).status,"delivered"))?" selected":""}>Entregado</option><option value="cancelled"${g(Array.isArray(r(_).status)?v(r(_).status,"cancelled"):y(r(_).status,"cancelled"))?" selected":""}>Cancelado</option></select></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Dirección de Envío </label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Dirección completa de envío">${p(r(_).shipping_address)}</textarea></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Dirección de Facturación </label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Dirección de facturación">${p(r(_).billing_address)}</textarea></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Método de Pago </label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,""):y(r(_).payment_method,""))?" selected":""}>Seleccionar método</option><option value="credit_card"${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,"credit_card"):y(r(_).payment_method,"credit_card"))?" selected":""}>Tarjeta de Crédito</option><option value="debit_card"${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,"debit_card"):y(r(_).payment_method,"debit_card"))?" selected":""}>Tarjeta de Débito</option><option value="paypal"${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,"paypal"):y(r(_).payment_method,"paypal"))?" selected":""}>PayPal</option><option value="cash"${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,"cash"):y(r(_).payment_method,"cash"))?" selected":""}>Efectivo</option><option value="bank_transfer"${g(Array.isArray(r(_).payment_method)?v(r(_).payment_method,"bank_transfer"):y(r(_).payment_method,"bank_transfer"))?" selected":""}>Transferencia Bancaria</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Estado del Pago </label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value="pending"${g(Array.isArray(r(_).payment_status)?v(r(_).payment_status,"pending"):y(r(_).payment_status,"pending"))?" selected":""}>Pendiente</option><option value="paid"${g(Array.isArray(r(_).payment_status)?v(r(_).payment_status,"paid"):y(r(_).payment_status,"paid"))?" selected":""}>Pagado</option><option value="failed"${g(Array.isArray(r(_).payment_status)?v(r(_).payment_status,"failed"):y(r(_).payment_status,"failed"))?" selected":""}>Fallido</option><option value="refunded"${g(Array.isArray(r(_).payment_status)?v(r(_).payment_status,"refunded"):y(r(_).payment_status,"refunded"))?" selected":""}>Reembolsado</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Número de Seguimiento </label><input${m("value",r(_).tracking_number)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Número de tracking"></div></div><div><div class="flex justify-between items-center mb-4"><h4 class="text-lg font-medium text-gray-900">Productos del Pedido</h4><button type="button" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm transition-colors">`),a(u(n,{name:"heroicons:plus",class:"w-4 h-4 inline mr-1"},null,o)),a(' Agregar Producto </button></div><div class="space-y-4">\x3c!--[--\x3e'),x(r(_).order_items,(e,t)=>{a(`<div class="grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border border-gray-200 rounded-lg"><div><label class="block text-sm font-medium text-gray-700 mb-1">Producto</label><select required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(e.product_id)?v(e.product_id,""):y(e.product_id,""))?" selected":""}>Seleccionar producto</option>\x3c!--[--\x3e`),x(r(h),t=>{a(`<option${m("value",t.id_product)}${g(Array.isArray(e.product_id)?v(e.product_id,t.id_product):y(e.product_id,t.id_product))?" selected":""}>${p(t.name)} - ${p(r(A)(t.price))}</option>`)}),a(`\x3c!--]--\x3e</select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Cantidad</label><input${m("value",e.quantity)} type="number" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Precio Unitario</label><input${m("value",e.unit_price)} type="number" step="0.01" min="0" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div class="flex items-end space-x-2"><div class="flex-1"><label class="block text-sm font-medium text-gray-700 mb-1">Total</label><input${m("value",e.total_price)} type="number" step="0.01" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50"></div><button type="button" class="text-red-600 hover:text-red-800 p-2" title="Eliminar producto">`),a(u(n,{name:"heroicons:trash",class:"w-5 h-5"},null,o)),a("</button></div></div>")}),a(`\x3c!--]--\x3e</div></div><div class="bg-gray-50 p-4 rounded-lg"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-2"><div class="flex justify-between"><span class="text-sm text-gray-600">Subtotal:</span><span class="text-sm font-medium">$${p(k2(r(w)))}</span></div><div class="flex justify-between"><span class="text-sm text-gray-600">Impuestos:</span><span class="text-sm font-medium">$${p(k2(r(_).tax_amount||0))}</span></div><div class="flex justify-between"><span class="text-sm text-gray-600">Envío:</span><span class="text-sm font-medium">$${p(k2(r(_).shipping_amount||0))}</span></div><div class="border-t pt-2"><div class="flex justify-between"><span class="text-lg font-bold text-gray-900">Total:</span><span class="text-lg font-bold text-gray-900">$${p(k2(r($)))}</span></div></div></div><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Impuestos</label><input${m("value",r(_).tax_amount)} type="number" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Envío</label><input${m("value",r(_).shipping_amount)} type="number" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Total del Pedido</label><input${m("value",r(_).total_amount)} type="number" step="0.01" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 font-bold text-lg"></div></div></div></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Notas</label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Notas adicionales del pedido">${p(r(_).notes)}</textarea></div><div class="flex space-x-3 pt-4"><button type="button" class="flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Cancelar </button><button type="submit"${g(r(l))?" disabled":""} class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">`),r(l)?a("<span>Guardando...</span>"):a(`<span>${p(e.order?"Actualizar":"Crear")}</span>`),a("</button></div></form></div></div></div>")}}},w=_.setup;_.setup=(e,t)=>{const s=l();return(s.modules||(s.modules=new Set)).add("components/admin/orders/OrderModal.vue"),w?w(e,t):void 0};const $={__name:"StatusUpdateModal",__ssrInlineRender:!0,props:{order:{type:Object,required:!0}},emits:["close","update"],setup(e,{emit:a}){const o=e,n=s(!1),l=s({status:"",tracking_number:"",notes:""});return d(()=>o.order,e=>{e&&(l.value={status:e.status||"",tracking_number:e.tracking_number||"",notes:""})},{immediate:!0}),(s,a,o,d)=>{var x,f,h,_,w,$,A,k,E;const P=t;var C,j,S;a(`<div${c(i({class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},d))}><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900"> Cambiar Estado del Pedido </h3><button class="text-gray-400 hover:text-gray-600">`),a(u(P,{name:"heroicons:x-mark",class:"w-6 h-6"},null,o)),a(`</button></div><div class="bg-gray-50 p-4 rounded-lg mb-4"><div class="text-sm text-gray-600"><p><strong>Pedido:</strong> #${p(null==(f=null==(x=e.order)?void 0:x.id_order)?void 0:f.slice(0,8))}</p><p><strong>Cliente:</strong> ${p(null==(_=null==(h=e.order)?void 0:h.customer)?void 0:_.first_name)} ${p(null==($=null==(w=e.order)?void 0:w.customer)?void 0:$.last_name)}</p><p><strong>Total:</strong> $${p((j=null==(A=e.order)?void 0:A.total_amount,parseFloat(j||0).toFixed(2)))}</p><p><strong>Estado Actual:</strong><span class="${b((C=null==(k=e.order)?void 0:k.status,{pending:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",confirmed:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",shipped:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",delivered:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",cancelled:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"}[C]||"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"))}">${p((S=null==(E=e.order)?void 0:E.status,{pending:"Pendiente",confirmed:"Aprobado",shipped:"Enviado",delivered:"Entregado",cancelled:"Cancelado"}[S]||"Desconocido"))}</span></p></div></div><form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1"> Nuevo Estado * </label><select required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(l).status)?v(r(l).status,""):y(r(l).status,""))?" selected":""}>Seleccionar estado</option><option value="pending"${g(Array.isArray(r(l).status)?v(r(l).status,"pending"):y(r(l).status,"pending"))?" selected":""}>Pendiente</option><option value="confirmed"${g(Array.isArray(r(l).status)?v(r(l).status,"confirmed"):y(r(l).status,"confirmed"))?" selected":""}>Confirmado</option><option value="shipped"${g(Array.isArray(r(l).status)?v(r(l).status,"shipped"):y(r(l).status,"shipped"))?" selected":""}>Enviado</option><option value="delivered"${g(Array.isArray(r(l).status)?v(r(l).status,"delivered"):y(r(l).status,"delivered"))?" selected":""}>Entregado</option><option value="cancelled"${g(Array.isArray(r(l).status)?v(r(l).status,"cancelled"):y(r(l).status,"cancelled"))?" selected":""}>Cancelado</option></select></div>`),"shipped"===r(l).status?a(`<div><label class="block text-sm font-medium text-gray-700 mb-1"> Número de Seguimiento </label><input${m("value",r(l).tracking_number)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Número de tracking"></div>`):a("\x3c!----\x3e"),a(`<div><label class="block text-sm font-medium text-gray-700 mb-1"> Notas del Cambio </label><textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Notas sobre el cambio de estado">${p(r(l).notes)}</textarea></div><div class="flex space-x-3 pt-4"><button type="button" class="flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Cancelar </button><button type="submit"${g(r(n)||!r(l).status)?" disabled":""} class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">`),r(n)?a("<span>Actualizando...</span>"):a("<span>Actualizar Estado</span>"),a("</button></div></form></div></div></div>")}}},A=$.setup;$.setup=(e,t)=>{const s=l();return(s.modules||(s.modules=new Set)).add("components/admin/orders/StatusUpdateModal.vue"),A?A(e,t):void 0};const k=o({__name:"PaymentUpdateModal",__ssrInlineRender:!0,props:{orderId:{}},emits:["close","saved"],setup(e,{emit:s}){const a=n({payment_status:"paid",payment_method:"",payment_reference:"",notes:""});return(e,s,o,d)=>{const n=t;s(`<div${c(i({class:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50"},d))}><div class="bg-white rounded-lg w-full max-w-md p-6 space-y-4"><div class="flex items-center justify-between"><h3 class="text-lg font-semibold">Actualizar pago</h3><button class="p-2 rounded hover:bg-gray-100">`),s(u(n,{name:"heroicons:x-mark",class:"w-5 h-5"},null,o)),s(`</button></div><div class="space-y-3"><div><label class="block text-sm text-gray-600 mb-1">Estado de pago</label><select class="w-full px-3 py-2 border rounded"><option value="paid"${g(Array.isArray(r(a).payment_status)?v(r(a).payment_status,"paid"):y(r(a).payment_status,"paid"))?" selected":""}>Pagado</option><option value="pending"${g(Array.isArray(r(a).payment_status)?v(r(a).payment_status,"pending"):y(r(a).payment_status,"pending"))?" selected":""}>Pendiente</option><option value="failed"${g(Array.isArray(r(a).payment_status)?v(r(a).payment_status,"failed"):y(r(a).payment_status,"failed"))?" selected":""}>Fallido</option><option value="refunded"${g(Array.isArray(r(a).payment_status)?v(r(a).payment_status,"refunded"):y(r(a).payment_status,"refunded"))?" selected":""}>Reembolsado</option></select></div><div><label class="block text-sm text-gray-600 mb-1">Método de pago</label><input${m("value",r(a).payment_method)} type="text" class="w-full px-3 py-2 border rounded" placeholder="Nequi, Bancolombia..."></div><div><label class="block text-sm text-gray-600 mb-1">Referencia</label><input${m("value",r(a).payment_reference)} type="text" class="w-full px-3 py-2 border rounded" placeholder="# de transacción"></div><div><label class="block text-sm text-gray-600 mb-1">Notas</label><textarea class="w-full px-3 py-2 border rounded" rows="3" placeholder="Notas opcionales">${p(r(a).notes)}</textarea></div></div><div class="flex justify-end gap-2 pt-2"><button class="px-4 py-2 border rounded">Cancelar</button><button class="px-4 py-2 bg-green-600 text-white rounded">Guardar</button></div></div></div>`)}}}),E=k.setup;k.setup=(e,t)=>{const s=l();return(s.modules||(s.modules=new Set)).add("components/admin/orders/PaymentUpdateModal.vue"),E?E(e,t):void 0};const P={__name:"index",__ssrInlineRender:!0,setup(o){const d=s([]),i=s([]),n=s(!1),l=s(""),w=s(""),A=s(""),E=s(""),P=s(""),C=s(1),j=s(10),S=s(!1),R=s(!1),N=s(!1),q=s(!1),D=s(null),T=s(null),M=s(!1),z=s(null),F=a(()=>{let e=[...(i.value||[]).map(e=>{var t,s,a;return{id_order:e.id_reservation,tracking_number:null,customer:e.user?{first_name:e.user.first_name,last_name:e.user.last_name,email:e.user.email}:null,total_amount:(null==(t=e.product)?void 0:t.price)?Number(e.product.price)*Number(e.quantity||1):0,order_items:[{quantity:e.quantity,unit_price:(null==(s=e.product)?void 0:s.price)||0,total_price:((null==(a=e.product)?void 0:a.price)||0)*(e.quantity||1)}],status:e.status,payment_status:"pending",order_source:"reservation",created_at:e.created_at,_isReservation:!0,_rawReservation:e}}),...d.value||[]];if(l.value){const t=l.value.toLowerCase();e=e.filter(e=>{var s,a;return String(e.id_order).toLowerCase().includes(t)||e.tracking_number&&e.tracking_number.toLowerCase().includes(t)||(null==(s=e.customer)?void 0:s.first_name)&&e.customer.first_name.toLowerCase().includes(t)||(null==(a=e.customer)?void 0:a.last_name)&&e.customer.last_name.toLowerCase().includes(t)})}if(w.value&&(e=e.filter(e=>e.status===w.value)),A.value&&(e=e.filter(e=>e.payment_status===A.value)),E.value){const t=new Date(E.value);e=e.filter(e=>new Date(e.created_at).toDateString()===t.toDateString())}return P.value&&(e="reservation"===P.value?e.filter(e=>e._isReservation):e.filter(e=>e.order_source===P.value)),e}),I=a(()=>F.value.length),L=a(()=>Math.ceil(I.value/j.value)),O=a(()=>(C.value-1)*j.value),U=a(()=>Math.min(O.value+j.value,I.value)),B=a(()=>{const e=[];let t=Math.max(1,C.value-Math.floor(2.5)),s=Math.min(L.value,t+5-1);s-t+1<5&&(t=Math.max(1,s-5+1));for(let a=t;a<=s;a++)e.push(a);return e}),G=s({total:0,pending:0,delivered:0,cancelled:0,paid:0}),H=async()=>{n.value=!0;try{const{data:e}=await $fetch("/api/orders");e.success?d.value=e.data:console.error("Error en la respuesta de la API:",e.error)}catch(e){console.error("Error fetching orders:",e)}finally{n.value=!1}},V=()=>{S.value=!1,D.value=null},J=()=>{N.value=!1,D.value=null},{$toast:K}=e(),Q=async()=>{await H(),null==K||K.success("Pago actualizado")},W=()=>{R.value=!1,D.value=null},X=async e=>{try{if(D.value){const{data:t}=await $fetch(`/api/orders/${D.value.id_order}`,{method:"PUT",body:e});t.success?(console.log("Pedido actualizado exitosamente"),await H(),V()):console.error("Error actualizando pedido:",t.error)}else{const{data:t}=await $fetch("/api/orders",{method:"POST",body:e});t.success?(console.log("Pedido creado exitosamente"),await H(),V()):console.error("Error creando pedido:",t.error)}}catch(e){console.error("Error saving order:",e)}},Y=async e=>{try{const{data:t}=await $fetch(`/api/orders/${D.value.id_order}/update-status`,{method:"PATCH",body:e});t.success?(null==K||K.success("Estado actualizado",`Nuevo estado: ${e.status}`),await H(),W()):null==K||K.error("Error",t.error)}catch(e){null==K||K.error("Error","No fue posible actualizar el estado")}},Z=async()=>{if(T.value)try{const{data:e}=await $fetch(`/api/orders/${T.value.id_order}`,{method:"DELETE"});e.success?(null==K||K.success("Pedido eliminado"),await H(),q.value=!1,T.value=null):null==K||K.error("Error",e.error)}catch(e){null==K||K.error("Error","No fue posible eliminar el pedido")}},ee=e=>({paid:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),{formatCOP:te}=f(),se=async()=>{const e=z.value;if(e)try{const{data:t}=await $fetch(`/api/reservations/${e.id_reservation}`,{method:"DELETE"});t.success?(null==K||K.success("Registro eliminado"),await(async()=>{try{const{data:e}=await $fetch("/api/reservations");e.success&&(i.value=e.data)}catch(e){console.error("Error fetching reservations:",e)}})(),M.value=!1,z.value=null):null==K||K.error("Error",t.error)}catch(e){null==K||K.error("Error","No fue posible eliminar el registro")}};return(e,s,a,o)=>{const d=t,i=_,n=$,f=k,j=h;s(`<div${c(o)}><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold text-gray-900">Gestión de Pedidos</h1><p class="text-gray-600">Administra todos los pedidos de tu tienda</p></div><div class="flex space-x-3"><button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">`),s(u(d,{name:"heroicons:plus-circle",class:"w-5 h-5"},null,a)),s('<span>Nuevo Pedido</span></button><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">'),s(u(d,{name:"heroicons:arrow-down-tray",class:"w-5 h-5"},null,a)),s('<span>Exportar</span></button></div></div><div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6"><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">'),s(u(d,{name:"heroicons:shopping-bag",class:"w-5 h-5 text-blue-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Total Pedidos</p><p class="text-2xl font-bold text-gray-900">${p(r(G).total)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">`),s(u(d,{name:"heroicons:clock",class:"w-5 h-5 text-yellow-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Pendientes</p><p class="text-2xl font-bold text-gray-900">${p(r(G).pending)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">`),s(u(d,{name:"heroicons:check-circle",class:"w-5 h-5 text-green-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Entregados</p><p class="text-2xl font-bold text-gray-900">${p(r(G).delivered)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">`),s(u(d,{name:"heroicons:x-circle",class:"w-5 h-5 text-red-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Cancelados</p><p class="text-2xl font-bold text-gray-900">${p(r(G).cancelled)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">`),s(u(d,{name:"heroicons:banknotes",class:"w-5 h-5 text-emerald-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Pagados</p><p class="text-2xl font-bold text-gray-900">${p(r(G).paid)}</p></div></div></div></div><div class="bg-white p-4 rounded-lg shadow-sm mb-6"><div class="grid grid-cols-1 md:grid-cols-6 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label><input${m("value",r(l))} type="text" placeholder="ID, cliente, tracking..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Estado</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(w))?v(r(w),""):y(r(w),""))?" selected":""}>Todos los estados</option><option value="pending"${g(Array.isArray(r(w))?v(r(w),"pending"):y(r(w),"pending"))?" selected":""}>Pendiente</option><option value="confirmed"${g(Array.isArray(r(w))?v(r(w),"confirmed"):y(r(w),"confirmed"))?" selected":""}>Confirmado</option><option value="shipped"${g(Array.isArray(r(w))?v(r(w),"shipped"):y(r(w),"shipped"))?" selected":""}>Enviado</option><option value="delivered"${g(Array.isArray(r(w))?v(r(w),"delivered"):y(r(w),"delivered"))?" selected":""}>Entregado</option><option value="cancelled"${g(Array.isArray(r(w))?v(r(w),"cancelled"):y(r(w),"cancelled"))?" selected":""}>Cancelado</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Pago</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(A))?v(r(A),""):y(r(A),""))?" selected":""}>Todos los pagos</option><option value="paid"${g(Array.isArray(r(A))?v(r(A),"paid"):y(r(A),"paid"))?" selected":""}>Pagado</option><option value="pending"${g(Array.isArray(r(A))?v(r(A),"pending"):y(r(A),"pending"))?" selected":""}>Pendiente</option><option value="failed"${g(Array.isArray(r(A))?v(r(A),"failed"):y(r(A),"failed"))?" selected":""}>Fallido</option><option value="refunded"${g(Array.isArray(r(A))?v(r(A),"refunded"):y(r(A),"refunded"))?" selected":""}>Reembolsado</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Fecha</label><input${m("value",r(E))} type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Origen</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${g(Array.isArray(r(P))?v(r(P),""):y(r(P),""))?" selected":""}>Todos</option><option value="admin"${g(Array.isArray(r(P))?v(r(P),"admin"):y(r(P),"admin"))?" selected":""}>Admin</option><option value="user"${g(Array.isArray(r(P))?v(r(P),"user"):y(r(P),"user"))?" selected":""}>User</option><option value="customer"${g(Array.isArray(r(P))?v(r(P),"customer"):y(r(P),"customer"))?" selected":""}>Cliente</option></select></div><div class="flex items-end"><button class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Limpiar Filtros </button></div></div></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Pedido </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Cliente </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Total </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Estado </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Pago </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Origen </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Fecha </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e`),x(r(F),e=>{var t,o,i,n,l,c,v;s('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center">'),s(u(d,{name:"heroicons:shopping-bag",class:"w-5 h-5 text-blue-600"},null,a)),s(`</div></div><div class="ml-4"><div class="text-sm font-medium text-gray-900">#${p(String(e.id_order||"").slice(0,8))}</div><div class="text-sm text-gray-500">${p(e.tracking_number||(e._isReservation?"Reserva":"Sin tracking"))}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${p(null==(t=e.customer)?void 0:t.first_name)} ${p(null==(o=e.customer)?void 0:o.last_name)}</div><div class="text-sm text-gray-500">${p(null==(i=e.customer)?void 0:i.email)}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${p(r(te)(e.total_amount))}</div><div class="text-sm text-gray-500">${p((null==(n=e.order_items)?void 0:n.length)||0)} productos</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center gap-2"><span class="${b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",(l=e.status,{pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[l]||"bg-gray-100 text-gray-800")])}">${p((v=e.status,{pending:"Pendiente",confirmed:"Aprobado",shipped:"Enviado",delivered:"Entregado",cancelled:"Cancelado"}[v]||"Desconocido"))}</span>`),"pending"!==e.status||"paid"===e.payment_status||e._isReservation?s("\x3c!----\x3e"):s('<span class="text-xs text-yellow-700">(pendiente de pago)</span>'),"pending"!==e.status||"paid"!==e.payment_status||e._isReservation?s("\x3c!----\x3e"):s('<span class="text-xs text-emerald-700">(pagado)</span>'),s(`</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",ee(e.payment_status)])}">${p((e=>({paid:"Pagado",pending:"Pendiente",failed:"Fallido",refunded:"Reembolsado"}[e]||"Desconocido"))(e.payment_status))}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="uppercase">${p(e._isReservation?"RESERVA":e.order_source||"")}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${p((c=e.created_at,c?new Date(c).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A"))}</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><div class="flex flex-wrap gap-2"><button${g(!(e=>(e._isReservation,"pending"===e.status))(e))?" disabled":""}${m("title",e._isReservation?"Aprobar (desde reserva)":"Aprobar pedido")} aria-label="Aprobar" class="inline-flex items-center justify-center w-9 h-9 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-40 disabled:cursor-not-allowed">`),s(u(d,{name:"heroicons:check-circle",class:"w-5 h-5"},null,a)),s(`</button><button${g(!(e=>(e._isReservation,"pending"===e.status))(e))?" disabled":""} title="Cancelar" aria-label="Cancelar" class="inline-flex items-center justify-center w-9 h-9 rounded border hover:bg-gray-50 disabled:opacity-40 disabled:cursor-not-allowed">`),s(u(d,{name:"heroicons:x-circle",class:"w-5 h-5 text-red-600"},null,a)),s('</button><button title="Eliminar" aria-label="Eliminar" class="inline-flex items-center justify-center w-9 h-9 rounded border hover:bg-gray-50">'),s(u(d,{name:"heroicons:trash",class:"w-5 h-5"},null,a)),s("</button></div></td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div>"),r(L)>1?(s(`<div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"><div class="flex-1 flex justify-between sm:hidden"><button${g(1===r(C))?" disabled":""} class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Anterior </button><button${g(r(C)===r(L))?" disabled":""} class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Siguiente </button></div><div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700"> Mostrando <span class="font-medium">${p(r(O)+1)}</span> a <span class="font-medium">${p(r(U))}</span> de <span class="font-medium">${p(r(I))}</span> resultados </p></div><div><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"><button${g(1===r(C))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(u(d,{name:"heroicons:chevron-left",class:"w-5 h-5"},null,a)),s("</button>\x3c!--[--\x3e"),x(r(B),e=>{s(`<button class="${b(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",e===r(C)?"z-10 bg-green-50 border-green-500 text-green-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])}">${p(e)}</button>`)}),s(`\x3c!--]--\x3e<button${g(r(C)===r(L))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(u(d,{name:"heroicons:chevron-right",class:"w-5 h-5"},null,a)),s("</button></nav></div></div></div>")):s("\x3c!----\x3e"),s("</div>"),r(S)?s(u(i,{order:r(D),onClose:V,onSave:X},null,a)):s("\x3c!----\x3e"),r(R)?s(u(n,{order:r(D),onClose:W,onUpdate:Y},null,a)):s("\x3c!----\x3e"),r(N)&&r(D)?s(u(f,{"order-id":r(D).id_order,onClose:J,onSaved:Q},null,a)):s("\x3c!----\x3e"),r(q)?s(u(j,{title:"Eliminar Pedido",message:"¿Estás seguro de que quieres eliminar este pedido? Esta acción no se puede deshacer.",onConfirm:Z,onCancel:e=>q.value=!1},null,a)):s("\x3c!----\x3e"),r(M)?s(u(j,{title:"Eliminar Apartado",message:"¿Estás seguro de que quieres eliminar este apartado? Esta acción no se puede deshacer.",onConfirm:se,onCancel:e=>M.value=!1},null,a)):s("\x3c!----\x3e"),s("</div>")}}},C=P.setup;P.setup=(e,t)=>{const s=l();return(s.modules||(s.modules=new Set)).add("pages/admin/orders/index.vue"),C?C(e,t):void 0};export{P as default};
//# sourceMappingURL=index-DBNWuMC6.mjs.map
