import{v as e,_ as t}from"./server.mjs";import{ref as r,computed as s,unref as o,defineComponent as a,watch as i,nextTick as l,useSSRContext as d}from"vue";import{ssrRenderAttrs as n,ssrRenderComponent as c,ssrRenderAttr as u,ssrIncludeBooleanAttr as m,ssrLooseContain as p,ssrLooseEqual as x,ssrRenderList as v,ssrInterpolate as b,ssrRenderClass as g,ssrRenderTeleport as f}from"vue/server-renderer";import{t as y}from"./useCurrency-BC2d31xw.mjs";import"../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";import"pinia";import"vue-router";import"tailwindcss/colors";import"@iconify/vue";import"reka-ui";import"@vueuse/core";import"tailwind-variants";import"@iconify/utils/lib/css/icon";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"unhead/plugins";const h=a({__name:"ProductAddModal",__ssrInlineRender:!0,props:{product:{default:null},categories:{default:()=>[]}},emits:["close","save"],setup(e,{emit:a}){const l=e,d=r(!1),n=r({name:"",description:"",price:0,stock_quantity:0,category_id:"",brand:"",sku:"",is_active:!0}),g=r(null),y=r(""),h=s(()=>!!l.product);return i(()=>l.product,()=>{l.product?(n.value={name:l.product.name,description:l.product.description,price:l.product.price,stock_quantity:l.product.stock_quantity,category_id:l.product.category_id,brand:l.product.brand,sku:l.product.sku,is_active:l.product.is_active},y.value=l.product.image_url||""):(n.value={name:"",description:"",price:0,stock_quantity:0,category_id:"",brand:"",sku:"",is_active:!0},y.value="",g.value=null)},{immediate:!0}),(e,r,s,a)=>{const i=t;f(r,t=>{t('<div class="fixed inset-0 z-[9998] overflow-y-auto" role="dialog" aria-modal="true"><div class="flex items-center justify-center min-h-screen p-4"><div class="fixed inset-0 bg-black/50"></div><div class="relative z-[9999] w-full max-w-2xl bg-white rounded-lg text-left overflow-hidden shadow-xl"><div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-pink-100 sm:mx-0 sm:h-10 sm:w-10">'),t(c(i,{name:o(h)?"heroicons:pencil-square":"heroicons:plus",class:"h-6 w-6 text-pink-600"},null,s)),t(`</div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"><h3 class="text-lg leading-6 font-medium text-gray-900">${b(o(h)?"Editar Producto":"Crear Nuevo Producto")}</h3><form class="mt-4 space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Nombre *</label><input${u("value",o(n).name)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Nombre del producto"></div><div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Descripción *</label><textarea rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Describe el producto...">${b(o(n).description)}</textarea></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Precio *</label><div class="relative"><span class="absolute left-3 top-2 text-gray-500">$</span><input${u("value",o(n).price)} type="number" step="0.01" min="0" required class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="0.00"></div></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Stock *</label><input${u("value",o(n).stock_quantity)} type="number" min="0" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="0"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Categoría *</label><select required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"><option value=""${m(Array.isArray(o(n).category_id)?p(o(n).category_id,""):x(o(n).category_id,""))?" selected":""}>Seleccionar categoría</option>\x3c!--[--\x3e`),v(e.categories,e=>{t(`<option${u("value",e.id_category)}${m(Array.isArray(o(n).category_id)?p(o(n).category_id,e.id_category):x(o(n).category_id,e.id_category))?" selected":""}>${b(e.name)}</option>`)}),t(`\x3c!--]--\x3e</select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Marca</label><input${u("value",o(n).brand)} type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Marca"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">SKU *</label><input${u("value",o(n).sku)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="SKU"></div><div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Imagen</label><input type="file" accept="image/*" class="w-full"></div><div class="col-span-2"><div class="flex items-center"><input${m(Array.isArray(o(n).is_active)?p(o(n).is_active,null):o(n).is_active)?" checked":""} type="checkbox" id="is_active" class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded"><label for="is_active" class="ml-2 block text-sm text-gray-900">Producto activo</label></div></div></div>`),o(y)?t(`<div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Vista previa</label><div class="w-32 h-32 border border-gray-300 rounded-lg overflow-hidden"><img${u("src",o(y))}${u("alt",o(n).name)} class="w-full h-full object-cover"></div></div>`):t("\x3c!----\x3e"),t(`</form></div></div></div><div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"><button type="submit"${m(o(d))?" disabled":""} class="w-full btn btn-primary sm:ml-3 sm:w-auto sm:text-sm">`),o(d)?t(c(i,{name:"heroicons:arrow-path",class:"w-4 h-4 mr-2 animate-spin"},null,s)):t("\x3c!----\x3e"),t(` ${b(o(h)?"Actualizar":"Crear")}</button><button type="button" class="mt-3 w-full btn btn-secondary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"> Cancelar </button></div></div></div></div>`)},"body",!1,s)}}}),w=h.setup;h.setup=(e,t)=>{const r=d();return(r.modules||(r.modules=new Set)).add("components/admin/products/ProductAddModal.vue"),w?w(e,t):void 0};const k={__name:"ProductDeleteModal",__ssrInlineRender:!0,props:{product:{type:Object,required:!0}},emits:["confirm","cancel"],setup:e=>(r,s,o,a)=>{const i=t;f(s,t=>{var r;t('<div class="fixed inset-0 z-[9998] overflow-y-auto" role="dialog" aria-modal="true"><div class="flex items-center justify-center min-h-screen p-4"><div class="fixed inset-0 bg-black/50"></div><div class="relative z-[9999] w-full max-w-lg bg-white rounded-lg text-left overflow-hidden shadow-xl"><div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">'),t(c(i,{name:"heroicons:exclamation-triangle",class:"h-6 w-6 text-red-600"},null,o)),t(`</div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-gray-900">Eliminar Producto</h3><div class="mt-2"><p class="text-sm text-gray-500"> ¿Estás seguro de que quieres eliminar el producto &#39;${b(null==(r=e.product)?void 0:r.name)}&#39;? Esta acción no se puede deshacer. </p></div></div></div></div><div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"><button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"> Confirmar </button><button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"> Cancelar </button></div></div></div></div>`)},"body",!1,o)}},_=k.setup;k.setup=(e,t)=>{const r=d();return(r.modules||(r.modules=new Set)).add("components/admin/products/ProductDeleteModal.vue"),_?_(e,t):void 0};const $={__name:"index",__ssrInlineRender:!0,setup(a){const i=r([]),d=r([]),f=r(!1),w=r(""),_=r(""),$=r(""),A=r(1),E=r(10),P=r(!1),j=r(!1),q=r(null),C=r(null),M=s(()=>{let e=i.value;if(w.value){const t=w.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}if(_.value&&(e=e.filter(e=>e.category_id===_.value)),""!==$.value){const t="true"===$.value;e=e.filter(e=>e.is_active===t)}return e}),S=s(()=>M.value.length),z=s(()=>Math.ceil(S.value/E.value)),I=s(()=>(A.value-1)*E.value),L=s(()=>Math.min(I.value+E.value,S.value)),D=s(()=>{const e=[];let t=Math.max(1,A.value-Math.floor(2.5)),r=Math.min(z.value,t+5-1);r-t+1<5&&(t=Math.max(1,r-5+1));for(let s=t;s<=r;s++)e.push(s);return e}),{formatCOP:U}=y(),T=async()=>{f.value=!0;try{const{data:e}=await $fetch("/api/products");e.success?i.value=e.data:console.error("Error en la respuesta de la API:",e.error)}catch(e){console.error("Error fetching products:",e)}finally{f.value=!1}},N=()=>{P.value=!1,q.value=null},K=e(),O=async e=>{try{if(q.value){const{data:t}=await $fetch(`/api/products/${e.get("id_product")}`,{method:"PUT",body:e});if(!t.success)return console.error("Error actualizando producto:",t.error),void K.add({title:t.error||"Error actualizando producto",color:"red"});K.add({title:"Producto actualizado",color:"green"})}else{const{data:t}=await $fetch("/api/products",{method:"POST",body:e});if(!t.success)return console.error("Error creando producto:",t.error),void K.add({title:t.error||"Error creando producto",color:"red"});K.add({title:"Producto creado",color:"green"})}await T(),N()}catch(e){console.error("Error saving product:",e),K.add({title:"Error guardando producto",color:"red"})}},R=async()=>{try{const{data:e}=await $fetch(`/api/products/${C.value.id_product}`,{method:"DELETE"});e.success?(K.add({title:"Producto eliminado",color:"green"}),await T(),l(()=>{j.value=!1,C.value=null})):(console.error("Error eliminando producto:",e.error),K.add({title:e.error||"Error eliminando producto",color:"red"}))}catch(e){console.error("Error deleting product:",e),K.add({title:"Error eliminando producto",color:"red"})}};return(e,r,s,a)=>{const i=t,l=h,f=k;r(`<div${n(a)}><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold text-gray-900">Gestión de Productos</h1><p class="text-gray-600">Administra el catálogo de productos de tu tienda</p></div><button class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">`),r(c(i,{name:"heroicons:plus",class:"w-5 h-5"},null,s)),r(`<span>Agregar Producto</span></button></div><div class="bg-white p-4 rounded-lg shadow-sm mb-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label><input${u("value",o(w))} type="text" placeholder="Nombre, SKU o descripción..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"><option value=""${m(Array.isArray(o(_))?p(o(_),""):x(o(_),""))?" selected":""}>Todas las categorías</option>\x3c!--[--\x3e`),v(o(d),e=>{r(`<option${u("value",e.id_category)}${m(Array.isArray(o(_))?p(o(_),e.id_category):x(o(_),e.id_category))?" selected":""}>${b(e.name)}</option>`)}),r(`\x3c!--]--\x3e</select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Estado</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"><option value=""${m(Array.isArray(o($))?p(o($),""):x(o($),""))?" selected":""}>Todos los estados</option><option value="true"${m(Array.isArray(o($))?p(o($),"true"):x(o($),"true"))?" selected":""}>Activo</option><option value="false"${m(Array.isArray(o($))?p(o($),"false"):x(o($),"false"))?" selected":""}>Inactivo</option></select></div><div class="flex items-end"><button class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Limpiar Filtros </button></div></div></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Producto </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Categoría </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Precio </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Stock </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Estado </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e`),v(o(M).slice(o(I),o(L)),e=>{var t;r('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-12 w-12">'),e.image_url?r(`<img${u("src",e.image_url)}${u("alt",e.name)} class="h-12 w-12 rounded-lg object-cover">`):(r('<div class="h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center">'),r(c(i,{name:"heroicons:photo",class:"w-6 h-6 text-gray-400"},null,s)),r("</div>")),r(`</div><div class="ml-4"><div class="text-sm font-medium text-gray-900">${b(e.name)}</div><div class="text-sm text-gray-500">${b(e.sku)}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${b((null==(t=e.category)?void 0:t.name)||"Sin categoría")}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${b(o(U)(e.price))}</td><td class="px-6 py-4 whitespace-nowrap"><span class="${g(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.stock_quantity>10?"bg-green-100 text-green-800":e.stock_quantity>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])}">${b(e.stock_quantity)}</span></td><td class="px-6 py-4 whitespace-nowrap"><span class="${g(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])}">${b(e.is_active?"Activo":"Inactivo")}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><div class="flex space-x-2"><button class="text-indigo-600 hover:text-indigo-900">`),r(c(i,{name:"heroicons:pencil-square",class:"w-5 h-5"},null,s)),r(`</button><button class="${g(["hover:text-gray-900",e.is_active?"text-red-600":"text-green-600"])}">`),r(c(i,{name:e.is_active?"heroicons:eye-slash":"heroicons:eye",class:"w-5 h-5"},null,s)),r('</button><button class="text-red-600 hover:text-red-900">'),r(c(i,{name:"heroicons:trash",class:"w-5 h-5"},null,s)),r("</button></div></td></tr>")}),r("\x3c!--]--\x3e</tbody></table></div>"),o(z)>1?(r(`<div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"><div class="flex-1 flex justify-between sm:hidden"><button${m(1===o(A))?" disabled":""} class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Anterior </button><button${m(o(A)===o(z))?" disabled":""} class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Siguiente </button></div><div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700"> Mostrando <span class="font-medium">${b(o(I)+1)}</span> a <span class="font-medium">${b(o(L))}</span> de <span class="font-medium">${b(o(S))}</span> resultados </p></div><div><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"><button${m(1===o(A))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),r(c(i,{name:"heroicons:chevron-left",class:"w-5 h-5"},null,s)),r("</button>\x3c!--[--\x3e"),v(o(D),e=>{r(`<button class="${g(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",e===o(A)?"z-10 bg-pink-50 border-pink-500 text-pink-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])}">${b(e)}</button>`)}),r(`\x3c!--]--\x3e<button${m(o(A)===o(z))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),r(c(i,{name:"heroicons:chevron-right",class:"w-5 h-5"},null,s)),r("</button></nav></div></div></div>")):r("\x3c!----\x3e"),r("</div>"),o(P)?r(c(l,{product:o(q),categories:o(d),onClose:N,onSave:O},null,s)):r("\x3c!----\x3e"),o(j)?r(c(f,{product:o(C),onConfirm:R,onCancel:e=>j.value=!1},null,s)):r("\x3c!----\x3e"),r("</div>")}}},A=$.setup;$.setup=(e,t)=>{const r=d();return(r.modules||(r.modules=new Set)).add("pages/admin/products/index.vue"),A?A(e,t):void 0};export{$ as default};
//# sourceMappingURL=index-BDp2XiWn.mjs.map
