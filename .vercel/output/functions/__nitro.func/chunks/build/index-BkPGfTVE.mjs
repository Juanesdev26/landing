import{_ as e}from"./server.mjs";import{defineComponent as t,ref as s,reactive as a,computed as r,unref as i,isRef as d,watch as o,mergeProps as l,useSSRContext as c}from"vue";import{ssrRenderAttrs as n,ssrRenderComponent as u,ssrRenderAttr as p,ssrRenderList as v,ssrInterpolate as x,ssrRenderClass as m,ssrIncludeBooleanAttr as b,ssrLooseContain as g,ssrLooseEqual as y}from"vue/server-renderer";import{t as f}from"./useCurrency-BC2d31xw.mjs";import"../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";import"pinia";import"vue-router";import"tailwindcss/colors";import"@iconify/vue";import"reka-ui";import"@vueuse/core";import"tailwind-variants";import"@iconify/utils/lib/css/icon";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"unhead/plugins";const h=t({__name:"ProductPickerDrawer",__ssrInlineRender:!0,props:{modelValue:{type:Boolean}},emits:["update:modelValue","select"],setup(t,{emit:a}){const r=t,d=s(!1),c=s([]),m=s([]),h=s(1),w=s(!1),_=s(""),$=s(""),{formatCOP:j}=f(),k=e=>e&&"object"==typeof e&&"data"in e?e.data:e,D=e=>!!e&&!0===e.success&&"data"in e;return o(()=>r.modelValue,e=>{e&&((async()=>{try{const e=k(await $fetch("/api/categories"));D(e)&&(c.value=e.data||[])}catch(e){console.error(e)}})(),(async()=>{h.value=1,d.value=!0;try{const e=new URLSearchParams;_.value&&e.set("category_id",_.value),$.value&&e.set("search",$.value),e.set("page",String(h.value)),e.set("page_size",String(10));const t=k(await $fetch(`/api/products?${e.toString()}`));if(D(t)){const e=t.data||[];m.value=e,w.value=10===e.length}}catch(e){console.error(e)}finally{d.value=!1}})())}),(t,s,a,r)=>{const o=e;t.modelValue?(s(`<div${n(l({class:"fixed inset-0 z-50"},r))}><div class="absolute inset-0 bg-black/40"></div><div class="absolute right-0 top-0 h-full w-full max-w-xl bg-white shadow-xl flex flex-col"><div class="p-4 border-b flex items-center justify-between"><h3 class="text-lg font-semibold">Seleccionar producto</h3><button class="p-2 rounded hover:bg-gray-100">`),s(u(o,{name:"heroicons:x-mark",class:"w-5 h-5"},null,a)),s(`</button></div><div class="p-4 border-b grid grid-cols-1 gap-3"><div class="flex gap-2"><select class="px-3 py-2 border rounded w-1/2"><option value=""${b(Array.isArray(i(_))?g(i(_),""):y(i(_),""))?" selected":""}>Todas las categorías</option>\x3c!--[--\x3e`),v(i(c),e=>{s(`<option${p("value",e.id_category)}${b(Array.isArray(i(_))?g(i(_),e.id_category):y(i(_),e.id_category))?" selected":""}>${x(e.name)}</option>`)}),s(`\x3c!--]--\x3e</select><input${p("value",i($))} type="text" placeholder="Buscar por nombre o SKU" class="px-3 py-2 border rounded w-full"><button class="px-4 py-2 border rounded">Buscar</button></div></div><div class="flex-1 overflow-auto">`),i(d)?s('<div class="p-6 text-gray-600">Cargando...</div>'):(s('<ul class="divide-y">\x3c!--[--\x3e'),v(i(m),e=>{var t;s('<li class="p-4 flex items-center gap-4">'),e.image_url?s(`<img${p("src",e.image_url)}${p("alt",e.name)} class="w-14 h-14 object-cover rounded">`):s("\x3c!----\x3e"),s(`<div class="flex-1 min-w-0"><div class="font-medium text-gray-900 truncate">${x(e.name)}</div><div class="text-sm text-gray-500 truncate">SKU: ${x(e.sku)} • ${x(null==(t=e.category)?void 0:t.name)}</div><div class="text-sm text-gray-700">${x(i(j)(e.price))}</div></div><button class="px-3 py-2 bg-pink-600 text-white rounded">Seleccionar</button></li>`)}),s("\x3c!--]--\x3e</ul>")),s(`</div><div class="p-4 border-t flex items-center justify-between"><button${b(1===i(h))?" disabled":""} class="px-3 py-2 border rounded disabled:opacity-50">Anterior</button><div class="text-sm text-gray-600">Página ${x(i(h))}</div><button${b(!i(w))?" disabled":""} class="px-3 py-2 border rounded disabled:opacity-50">Siguiente</button></div></div></div>`)):s("\x3c!----\x3e")}}}),w=h.setup;h.setup=(e,t)=>{const s=c();return(s.modules||(s.modules=new Set)).add("components/admin/products/ProductPickerDrawer.vue"),w?w(e,t):void 0};const _=t({__name:"index",__ssrInlineRender:!0,setup(t){const o=s([]),l=a({sku:""}),c=s(!1),y=s(!1),w=a({id_offer:null,product_id:"",discount_percent:0,is_active:!0,valid_from:"",valid_to:"",notes:""}),_=s(!1),$=s(null),{formatCOP:j}=f(),A=r(()=>o.value),P=r(()=>A.value.filter(e=>{var t;return!l.sku||((null==(t=e.product)?void 0:t.sku)||"").toLowerCase().includes(l.sku.toLowerCase())})),C=r(()=>P.value),U=e=>{$.value=e,w.product_id=e.id_product},S=e=>new Date(e).toLocaleString();return(t,s,a,r)=>{var o;const f=e,A=h;var P,V;s(`<div${n(r)}><div class="flex items-center justify-between mb-6"><div><h1 class="text-2xl font-bold text-gray-900">Gestión de Ofertas</h1><p class="text-gray-600">Descuentos visibles para todos los usuarios</p></div><button class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">`),s(u(f,{name:"heroicons:plus",class:"w-5 h-5"},null,a)),s(`<span>Nueva Oferta</span></button></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><div class="p-4 border-b flex gap-4"><input${p("value",i(l).sku)} type="text" placeholder="Filtrar por SKU" class="px-3 py-2 border rounded w-64"><button class="px-4 py-2 border rounded">Aplicar</button><button class="px-4 py-2 border rounded">Limpiar</button></div><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Producto</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descuento</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vigencia</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e`),v(i(C),e=>{var t,r;s(`<tr><td class="px-6 py-4"><div class="text-sm font-medium text-gray-900">${x(null==(t=e.product)?void 0:t.name)}</div><div class="text-sm text-gray-500">SKU: ${x(null==(r=e.product)?void 0:r.sku)}</div></td><td class="px-6 py-4"><span class="text-pink-600 font-semibold">-${x(e.discount_percent)}%</span></td><td class="px-6 py-4 text-sm text-gray-700"><div>${x(e.valid_from?S(e.valid_from):"—")} → ${x(e.valid_to?S(e.valid_to):"—")}</div></td><td class="px-6 py-4"><span class="${m([e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 rounded text-xs"])}">${x(e.is_active?"Activa":"Inactiva")}</span></td><td class="px-6 py-4 text-sm"><div class="flex gap-2"><button class="text-indigo-600 hover:text-indigo-900">`),s(u(f,{name:"heroicons:pencil-square",class:"w-5 h-5"},null,a)),s('</button><button class="text-red-600 hover:text-red-900">'),s(u(f,{name:"heroicons:trash",class:"w-5 h-5"},null,a)),s("</button></div></td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div></div>"),i(c)?(s(`<div class="fixed inset-0 bg-black/40 flex items-center justify-center p-4"><div class="bg-white rounded-lg w-full max-w-lg p-6 space-y-4"><h3 class="text-lg font-semibold">${x(i(y)?"Editar":"Nueva")} oferta</h3><div class="grid grid-cols-1 gap-3"><div><div class="flex items-center gap-2"><input${p("value",i(w).product_id)} type="text" placeholder="Product ID" class="px-3 py-2 border rounded flex-1"><button type="button" class="px-3 py-2 border rounded">Buscar producto</button></div>`),i($)?(s('<div class="mt-2 p-3 border rounded bg-gray-50 flex items-center gap-3">'),i($).image_url?s(`<img${p("src",i($).image_url)} class="w-12 h-12 object-cover rounded">`):s("\x3c!----\x3e"),s(`<div class="text-sm"><div class="font-medium">${x(i($).name)}</div><div class="text-gray-500">SKU: ${x(i($).sku)}</div></div></div>`)):s("\x3c!----\x3e"),s(`</div><div class="grid grid-cols-2 gap-3 items-end"><div><label class="block text-xs text-gray-600 mb-1">Descuento %</label><input${p("value",i(w).discount_percent)} type="number" min="0" max="100" placeholder="Descuento %" class="px-3 py-2 border rounded w-full"></div>`),i($)?(s('<div class="text-sm">'),i($).price?s(`<div class="text-gray-500 line-through">${x(i(j)(i($).price))}</div>`):s("\x3c!----\x3e"),s(`<div class="text-pink-600 font-semibold">${x(i(j)((P=null==(o=i($))?void 0:o.price,V=i(w).discount_percent,P?Math.round(Number(P)*(1-Number(V||0)/100)):0)))}</div></div>`)):s("\x3c!----\x3e"),s(`</div><label class="flex items-center gap-2 text-sm"><input type="checkbox"${b(Array.isArray(i(w).is_active)?g(i(w).is_active,null):i(w).is_active)?" checked":""}> Activa</label><div class="grid grid-cols-2 gap-3"><div><label class="block text-xs text-gray-600 mb-1">Inicio</label><input${p("value",i(w).valid_from)} type="datetime-local" class="px-3 py-2 border rounded w-full"></div><div><label class="block text-xs text-gray-600 mb-1">Fin</label><input${p("value",i(w).valid_to)} type="datetime-local" class="px-3 py-2 border rounded w-full"></div></div><textarea placeholder="Notas" class="px-3 py-2 border rounded">${x(i(w).notes)}</textarea></div><div class="flex justify-end gap-2 pt-2"><button class="px-4 py-2 border rounded">Cancelar</button><button class="px-4 py-2 bg-pink-600 text-white rounded">Guardar</button></div></div></div>`)):s("\x3c!----\x3e"),s(u(A,{modelValue:i(_),"onUpdate:modelValue":e=>d(_)?_.value=e:null,onSelect:U},null,a)),s("</div>")}}}),$=_.setup;_.setup=(e,t)=>{const s=c();return(s.modules||(s.modules=new Set)).add("pages/admin/offers/index.vue"),$?$(e,t):void 0};export{_ as default};
//# sourceMappingURL=index-BkPGfTVE.mjs.map
