import{_ as e,w as t}from"./server.mjs";import{ref as s,computed as a,unref as o,defineComponent as r,watch as i,mergeProps as l,useSSRContext as d}from"vue";import{ssrRenderAttrs as n,ssrRenderComponent as c,ssrInterpolate as u,ssrRenderAttr as m,ssrIncludeBooleanAttr as p,ssrLooseContain as x,ssrLooseEqual as v,ssrRenderList as y,ssrRenderClass as g}from"vue/server-renderer";import"../_/nitro.mjs";import"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@supabase/ssr";import"@iconify/utils";import"node:crypto";import"consola";import"ioredis";import"node:fs";import"node:path";import"pinia";import"vue-router";import"tailwindcss/colors";import"@iconify/vue";import"reka-ui";import"@vueuse/core";import"tailwind-variants";import"@iconify/utils/lib/css/icon";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"unhead/plugins";const f={__name:"StockAdjustmentModal",__ssrInlineRender:!0,props:{product:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:o}){const r=e;s(!1),s([]);const l=s({product_id:"",adjustment_type:"",quantity:0,reason:"",description:"",adjustment_date:""});return a(()=>!!r.product),i(()=>r.product,()=>{(()=>{r.product&&(l.value.product_id=r.product.id_product);const e=new Date,t=new Date(e.getTime()-6e4*e.getTimezoneOffset());l.value.adjustment_date=t.toISOString().slice(0,16)})()},{immediate:!0}),(e,s,a,o)=>{s(c(t,o,{},a))}}},b=f.setup;f.setup=(e,t)=>{const s=d();return(s.modules||(s.modules=new Set)).add("components/admin/inventory/StockAdjustmentModal.vue"),b?b(e,t):void 0};const h=r({__name:"MovementsHistoryModal",__ssrInlineRender:!0,props:{product:{}},emits:["close"],setup(t,{emit:a}){const r=s(!1),i=s([]);return(t,s,a,d)=>{const m=e;s(`<div${n(l({class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},d))}><div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-4"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold">Historial de movimientos</h3><button class="text-gray-600 hover:text-gray-800">`),s(c(m,{name:"heroicons:x-mark",class:"w-5 h-5"},null,a)),s('</button></div><div class="max-h-[60vh] overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cantidad</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Stock</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Motivo</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),y(o(i),e=>{var t;s(`<tr><td class="px-4 py-2 text-sm text-gray-700">${u((t=e.movement_date||e.created_at,t?new Date(t).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A"))}</td><td class="px-4 py-2 text-sm">${u(e.movement_type)}</td><td class="px-4 py-2 text-sm">${u(e.quantity)}</td><td class="px-4 py-2 text-sm">${u(e.stock_before)} → ${u(e.stock_after)}</td><td class="px-4 py-2 text-sm">${u(e.reason)}</td></tr>`)}),s("\x3c!--]--\x3e"),o(r)||0!==o(i).length?s("\x3c!----\x3e"):s('<tr><td colspan="5" class="px-4 py-6 text-center text-sm text-gray-500">Sin movimientos</td></tr>'),s("</tbody></table>"),o(r)?s('<div class="py-6 text-center text-sm text-gray-500">Cargando...</div>'):s("\x3c!----\x3e"),s("</div></div></div>")}}}),w=h.setup;h.setup=(e,t)=>{const s=d();return(s.modules||(s.modules=new Set)).add("components/admin/inventory/MovementsHistoryModal.vue"),w?w(e,t):void 0};const k={__name:"index",__ssrInlineRender:!0,setup(t){const r=s([]),i=s([]),l=s([]),d=s(!1),b=s(""),w=s(""),k=s(""),_=s(""),$=s(1),S=s(10),j=s(!1),A=s(!1),q=s(null),M=a(()=>{let e=r.value;if(b.value){const t=b.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t))}return w.value&&(e=e.filter(e=>e.category_id===w.value)),k.value&&(e=e.filter(e=>O(e.stock_quantity,e.min_stock)===k.value)),_.value&&(e=e.filter(e=>e.provider_id===_.value)),e}),C=a(()=>M.value.length),z=a(()=>Math.ceil(C.value/S.value)),E=a(()=>($.value-1)*S.value),T=a(()=>Math.min(E.value+S.value,C.value)),D=a(()=>{const e=[];let t=Math.max(1,$.value-Math.floor(2.5)),s=Math.min(z.value,t+5-1);s-t+1<5&&(t=Math.max(1,s-5+1));for(let a=t;a<=s;a++)e.push(a);return e}),H=a(()=>({totalProducts:r.value.length,adequateStock:r.value.filter(e=>"adequate"===O(e.stock_quantity,e.min_stock)).length,lowStock:r.value.filter(e=>"low"===O(e.stock_quantity,e.min_stock)).length,outOfStock:r.value.filter(e=>"out"===O(e.stock_quantity,e.min_stock)).length})),P=()=>{j.value=!1,q.value=null},I=()=>{A.value=!1,q.value=null},L=async e=>{try{const{data:t}=await $fetch("/api/inventory/adjustments",{method:"POST",body:e});t.success?(console.log("Ajuste de stock realizado exitosamente"),await(async()=>{d.value=!0;try{const{data:e}=await $fetch("/api/inventory");e.success?r.value=e.data:console.error("Error en la respuesta de la API:",e.error)}catch(e){console.error("Error fetching inventory:",e)}finally{d.value=!1}})(),P()):console.error("Error realizando ajuste:",t.error)}catch(e){console.error("Error saving adjustment:",e)}},O=(e,t)=>e<=0?"out":e<=(t||5)?"low":"adequate",B=(e,t)=>{switch(O(e,t)){case"out":return"bg-red-100 text-red-800";case"low":return"bg-yellow-100 text-yellow-800";case"adequate":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return(t,s,a,r)=>{const d=e,S=f,N=h;s(`<div${n(r)}><div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold text-gray-900">Gestión de Inventario</h1><p class="text-gray-600">Controla el stock y movimientos de productos de tu tienda</p></div><div class="flex space-x-3"><button class="btn btn-primary flex items-center space-x-2">`),s(c(d,{name:"heroicons:adjustments-horizontal",class:"w-5 h-5"},null,a)),s('<span>Ajuste de Stock</span></button></div></div><div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">'),s(c(d,{name:"heroicons:cube",class:"w-5 h-5 text-blue-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Total Productos</p><p class="text-2xl font-bold text-gray-900">${u(o(H).totalProducts)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">`),s(c(d,{name:"heroicons:check-circle",class:"w-5 h-5 text-green-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Stock Adecuado</p><p class="text-2xl font-bold text-gray-900">${u(o(H).adequateStock)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">`),s(c(d,{name:"heroicons:exclamation-triangle",class:"w-5 h-5 text-yellow-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Stock Bajo</p><p class="text-2xl font-bold text-gray-900">${u(o(H).lowStock)}</p></div></div></div><div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center"><div class="flex-shrink-0"><div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">`),s(c(d,{name:"heroicons:x-circle",class:"w-5 h-5 text-red-600"},null,a)),s(`</div></div><div class="ml-4"><p class="text-sm font-medium text-gray-500">Sin Stock</p><p class="text-2xl font-bold text-gray-900">${u(o(H).outOfStock)}</p></div></div></div></div><div class="bg-white p-4 rounded-lg shadow-sm mb-6"><div class="grid grid-cols-1 md:grid-cols-5 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label><input${m("value",o(b))} type="text" placeholder="Nombre, SKU..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${p(Array.isArray(o(w))?x(o(w),""):v(o(w),""))?" selected":""}>Todas las categorías</option>\x3c!--[--\x3e`),y(o(i),e=>{s(`<option${m("value",e.id_category)}${p(Array.isArray(o(w))?x(o(w),e.id_category):v(o(w),e.id_category))?" selected":""}>${u(e.name)}</option>`)}),s(`\x3c!--]--\x3e</select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Estado Stock</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${p(Array.isArray(o(k))?x(o(k),""):v(o(k),""))?" selected":""}>Todos los estados</option><option value="adequate"${p(Array.isArray(o(k))?x(o(k),"adequate"):v(o(k),"adequate"))?" selected":""}>Stock Adecuado</option><option value="low"${p(Array.isArray(o(k))?x(o(k),"low"):v(o(k),"low"))?" selected":""}>Stock Bajo</option><option value="out"${p(Array.isArray(o(k))?x(o(k),"out"):v(o(k),"out"))?" selected":""}>Sin Stock</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Proveedor</label><select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"><option value=""${p(Array.isArray(o(_))?x(o(_),""):v(o(_),""))?" selected":""}>Todos los proveedores</option>\x3c!--[--\x3e`),y(o(l),e=>{s(`<option${m("value",e.id_provider)}${p(Array.isArray(o(_))?x(o(_),e.id_provider):v(o(_),e.id_provider))?" selected":""}>${u(e.name)}</option>`)}),s('\x3c!--]--\x3e</select></div><div class="flex items-end"><button class="w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"> Limpiar Filtros </button></div></div></div><div class="bg-white rounded-lg shadow-sm overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Producto </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Categoría </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Stock Actual </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Stock Mínimo </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Estado </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Último Movimiento </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),y(o(M).slice(o(E),o(T)),e=>{var t,o;s('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-12 w-12">'),e.image_url?s(`<img${m("src",e.image_url)}${m("alt",e.name)} class="h-12 w-12 rounded-lg object-cover">`):(s('<div class="h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center">'),s(c(d,{name:"heroicons:photo",class:"w-6 h-6 text-gray-400"},null,a)),s("</div>")),s(`</div><div class="ml-4"><div class="text-sm font-medium text-gray-900">${u(e.name)}</div><div class="text-sm text-gray-500">${u(e.sku)}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${u((null==(t=e.category)?void 0:t.name)||"Sin categoría")}</span></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${u(e.stock_quantity)}</div><div class="text-xs text-gray-500">unidades</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${u(e.min_stock||0)}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${g(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",B(e.stock_quantity,e.min_stock)])}">${u(((e,t)=>{switch(O(e,t)){case"out":return"Sin Stock";case"low":return"Stock Bajo";case"adequate":return"Stock Adecuado";default:return"Desconocido"}})(e.stock_quantity,e.min_stock))}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${u((o=e.last_movement_date,o?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A"))}</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><div class="flex space-x-2"><button class="text-blue-600 hover:text-blue-900" title="Ver movimientos">`),s(c(d,{name:"heroicons:eye",class:"w-5 h-5"},null,a)),s('</button><button class="text-orange-600 hover:text-orange-900" title="Ajustar stock">'),s(c(d,{name:"heroicons:adjustments-horizontal",class:"w-5 h-5"},null,a)),s("</button></div></td></tr>")}),s("\x3c!--]--\x3e</tbody></table></div>"),o(z)>1?(s(`<div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"><div class="flex-1 flex justify-between sm:hidden"><button${p(1===o($))?" disabled":""} class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Anterior </button><button${p(o($)===o(z))?" disabled":""} class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> Siguiente </button></div><div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700"> Mostrando <span class="font-medium">${u(o(E)+1)}</span> a <span class="font-medium">${u(o(T))}</span> de <span class="font-medium">${u(o(C))}</span> resultados </p></div><div><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"><button${p(1===o($))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(c(d,{name:"heroicons:chevron-left",class:"w-5 h-5"},null,a)),s("</button>\x3c!--[--\x3e"),y(o(D),e=>{s(`<button class="${g(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",e===o($)?"z-10 bg-green-50 border-green-500 text-green-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])}">${u(e)}</button>`)}),s(`\x3c!--]--\x3e<button${p(o($)===o(z))?" disabled":""} class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">`),s(c(d,{name:"heroicons:chevron-right",class:"w-5 h-5"},null,a)),s("</button></nav></div></div></div>")):s("\x3c!----\x3e"),s("</div>"),o(j)?s(c(S,{product:o(q),onClose:P,onSave:L},null,a)):s("\x3c!----\x3e"),o(A)?s(c(N,{product:o(q),onClose:I},null,a)):s("\x3c!----\x3e"),s("</div>")}}},_=k.setup;k.setup=(e,t)=>{const s=d();return(s.modules||(s.modules=new Set)).add("pages/admin/inventory/index.vue"),_?_(e,t):void 0};export{k as default};
//# sourceMappingURL=index-YcmUCB92.mjs.map
